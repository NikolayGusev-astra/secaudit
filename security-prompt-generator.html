<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC_PROMPT_GENERATOR // STACK-AWARE EDITION</title>
    <style>
        :root {
            --bg: #0d1117;
            --panel: #161b22;
            --border: #30363d;
            --text: #c9d1d9;
            --accent: #58a6ff;
            --green: #2ea043;
            --red: #da3633;
            --font-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }
        h1 { font-size: 1.2rem; margin: 0; color: var(--accent); }
        .container {
            display: flex;
            gap: 20px;
            flex: 1;
            overflow: hidden;
        }
        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
        }
        .panel-header {
            padding: 10px 15px;
            background: #21262d;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        textarea {
            flex: 1;
            background: var(--bg);
            border: none;
            color: var(--text);
            padding: 15px;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            resize: none;
            outline: none;
        }
        .results-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-family: var(--font-mono);
        }
        .prompt-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .prompt-card.high { border-left-color: var(--red); }
        .prompt-card.med { border-left-color: var(--green); }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: #8b949e;
        }
        .prompt-content {
            font-size: 0.85rem;
            color: #e6edf3;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        .btn {
            background: #238636;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .btn:hover { background: #2ea043; }
        .btn-main { padding: 8px 16px; font-size: 0.9rem; }
        .badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            background: #30363d;
        }
        .badge-high { background: rgba(218, 54, 51, 0.2); color: #f85149; border: 1px solid #da3633; }
        .badge-med { background: rgba(46, 160, 67, 0.2); color: #3fb950; border: 1px solid #2ea043; }

        .stack-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--bg);
            border-radius: 4px;
        }
        select {
            background: var(--panel);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        select:focus { outline: 1px solid var(--accent); }
    </style>
</head>
<body>

    <header>
        <h1>SEC_PROMPT_GENERATOR // STACK-AWARE EDITION</h1>
        <button class="btn btn-main" onclick="generatePrompts()">GENERATE AI PROMPTS</button>
    </header>

    <div class="container">
        <!-- INPUT PANEL -->
        <div class="panel">
            <div class="panel-header">
                <span>INPUT: RAW REPORT (MARKDOWN)</span>
                <button class="btn" onclick="clearInput()">CLEAR</button>
            </div>
            <div class="stack-selector">
                <label for="techStack">Tech Stack:</label>
                <select id="techStack">
                    <option value="nextjs-vercel">Next.js / Vercel / React</option>
                    <option value="php-laravel">PHP / Laravel / Apache</option>
                    <option value="python-django">Python / Django / Flask</option>
                    <option value="java-spring">Java / Spring Boot / Tomcat</option>
                    <option value="static-nginx">Static HTML / Nginx</option>
                </select>
            </div>
            <textarea id="inputReport" placeholder="Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÑŽÐ´Ð° Ð²Ð°Ñˆ Markdown Ð¾Ñ‚Ñ‡ÐµÑ‚..."></textarea>
        </div>

        <!-- OUTPUT PANEL -->
        <div class="panel">
            <div class="panel-header">
                <span>OUTPUT: AI PROMPTS</span>
                <span id="stats" style="font-weight:normal; color:#8b949e;">0 prompts</span>
            </div>
            <div class="results-area" id="outputArea">
                <div style="text-align: center; color: #484f58; margin-top: 50px;">
                    Waiting for input data...
                </div>
            </div>
        </div>
    </div>

    <script>
        // TECH STACKS MATRIX - Client-side version for the HTML tool
        const TECH_STACKS_MATRIX = {
            'nextjs-vercel': {
                name: 'Next.js / Vercel / React',
                configFiles: 'next.config.js, vercel.json, middleware.ts',
                headers: {
                    locations: 'next.config.js (headers object), vercel.json (routes/headers), public/_headers',
                    context: 'Add security headers in next.config.js under headers array or use Vercel Edge Middleware for dynamic headers.'
                },
                serverInfo: {
                    locations: 'next.config.js',
                    context: 'Set poweredByHeader: false in next.config.js to hide Next.js version disclosure.'
                },
                xssCode: {
                    locations: 'src/app/**/*.tsx, src/pages/**/*.jsx, src/components/**/*.tsx',
                    context: 'Replace onclick="func()" with onClick={handleClick}. Use React synthetic events. Sanitize HTML with DOMPurify before dangerouslySetInnerHTML.'
                },
                images: {
                    locations: 'src/components/**/*.{tsx,jsx}',
                    context: 'Use Next.js <Image /> component instead of <img>. Configure domains in next.config.js images.domains for external images.'
                },
                compression: {
                    locations: 'vercel.json, next.config.js',
                    context: 'Vercel enables compression automatically. Configure next.config.js: compress: true for additional control.'
                },
                caching: {
                    locations: 'next.config.js, vercel.json',
                    context: 'Configure Cache-Control headers in next.config.js headers array. Use Vercel Edge Middleware for dynamic caching.'
                },
                cors: {
                    locations: 'next.config.js, vercel.json, middleware.ts',
                    context: 'Configure CORS in next.config.js headers or use Vercel Edge Middleware for API routes.'
                }
            },

            'php-laravel': {
                name: 'PHP / Laravel / Apache',
                configFiles: '.htaccess, httpd.conf, nginx.conf',
                headers: {
                    locations: '.htaccess, public/.htaccess, app/Http/Middleware/',
                    context: 'Use Header set directives in .htaccess or create Laravel middleware classes in app/Http/Middleware/ for programmatic headers.'
                },
                serverInfo: {
                    locations: '.htaccess, httpd.conf',
                    context: 'Use Header unset Server in .htaccess or ServerTokens Prod in httpd.conf to hide server information.'
                },
                xssCode: {
                    locations: 'resources/views/**/*.blade.php, app/**/*.php, public/**/*.php',
                    context: 'Use {{ }} escaping in Blade templates. In raw PHP, use htmlspecialchars() for output. Avoid echo with user input.'
                },
                images: {
                    locations: 'resources/views/**/*.blade.php, public/images/',
                    context: 'Validate image uploads server-side. Use proper file extensions. Consider image optimization libraries like Intervention Image.'
                },
                compression: {
                    locations: '.htaccess, httpd.conf, nginx.conf',
                    context: 'Enable mod_deflate in Apache or gzip in nginx. Configure compression levels and file types.'
                },
                caching: {
                    locations: '.htaccess, app/Http/Middleware/',
                    context: 'Set Cache-Control headers in .htaccess or Laravel middleware. Use proper ETag generation.'
                },
                cors: {
                    locations: 'app/Http/Middleware/Cors.php, config/cors.php',
                    context: 'Configure CORS in Laravel using config/cors.php or custom middleware for specific routes.'
                }
            },

            'python-django': {
                name: 'Python / Django / Flask',
                configFiles: 'settings.py, wsgi.py, nginx.conf',
                headers: {
                    locations: 'settings.py, middleware.py, nginx.conf',
                    context: 'Configure SECURE_* settings in settings.py. Use custom middleware classes for additional headers. Configure nginx for proxy headers.'
                },
                serverInfo: {
                    locations: 'settings.py, wsgi.py',
                    context: 'Remove or modify SERVER header in Django settings. Use custom WSGI middleware if needed.'
                },
                xssCode: {
                    locations: 'templates/**/*.html, **/*.py',
                    context: 'Ensure auto-escaping is enabled in Django (default). Use |escape filter manually. In Flask, use autoescape=True in render_template.'
                },
                images: {
                    locations: 'static/images/, media/images/',
                    context: 'Validate image uploads in views.py. Use Django ImageField. Configure file permissions and storage.'
                },
                compression: {
                    locations: 'nginx.conf, middleware.py',
                    context: 'Enable gzip compression in nginx reverse proxy. Use Django middleware for response compression if needed.'
                },
                caching: {
                    locations: 'settings.py, urls.py, nginx.conf',
                    context: 'Configure Django caching framework. Set Cache-Control headers in views or nginx. Use ETags for static files.'
                },
                cors: {
                    locations: 'settings.py, urls.py, middleware.py',
                    context: 'Install django-cors-headers. Configure CORS_ORIGIN_WHITELIST in settings.py or use custom middleware.'
                }
            },

            'java-spring': {
                name: 'Java / Spring Boot / Tomcat',
                configFiles: 'application.properties, application.yml, WebSecurityConfig.java',
                headers: {
                    locations: 'WebSecurityConfig.java, application.yml, web.xml',
                    context: 'Configure Spring Security httpSecurity.headers() in WebSecurityConfig.java. Use application.yml for additional headers.'
                },
                serverInfo: {
                    locations: 'application.properties, server.xml',
                    context: 'Configure server.server-header in application.properties or server.xml to hide server information.'
                },
                xssCode: {
                    locations: 'src/main/resources/templates/**/*.html, **/*.jsp, **/*.java',
                    context: 'Thymeleaf escapes by default. For JSP, use <c:out> or fn:escapeXml(). In Java code, validate and sanitize user input.'
                },
                images: {
                    locations: 'src/main/resources/static/images/, **/*.java',
                    context: 'Validate file uploads in controllers. Use Spring multipart configuration. Set proper file permissions.'
                },
                compression: {
                    locations: 'application.properties, server.xml, nginx.conf',
                    context: 'Configure compression in application.properties or nginx reverse proxy. Enable gzip for responses.'
                },
                caching: {
                    locations: 'WebConfig.java, application.yml, nginx.conf',
                    context: 'Configure Cache-Control headers in Spring MVC config. Use @Cacheable annotations. Set headers in nginx.'
                },
                cors: {
                    locations: 'WebSecurityConfig.java, application.yml',
                    context: 'Configure CORS in Spring Security with cors() method or @CrossOrigin annotations on controllers.'
                }
            },

            'static-nginx': {
                name: 'Static HTML / Nginx',
                configFiles: 'nginx.conf, conf.d/default.conf',
                headers: {
                    locations: 'nginx.conf, .htaccess',
                    context: 'Use add_header directives in nginx.conf server block. For Apache, use Header set in .htaccess.'
                },
                serverInfo: {
                    locations: 'nginx.conf',
                    context: 'Use server_tokens off; in nginx.conf to hide version information.'
                },
                xssCode: {
                    locations: 'index.html, **/*.html, **/*.js',
                    context: 'Remove onclick="..." entirely. Move JavaScript to external files. Use addEventListener() instead of inline handlers.'
                },
                images: {
                    locations: '**/*.html, images/',
                    context: 'Use proper image formats. Implement lazy loading. Validate file paths and extensions.'
                },
                compression: {
                    locations: 'nginx.conf',
                    context: 'Enable gzip on; and configure gzip_types in nginx.conf for HTML, CSS, JS, JSON files.'
                },
                caching: {
                    locations: 'nginx.conf, .htaccess',
                    context: 'Use expires directives in nginx.conf. Set Cache-Control headers based on file types.'
                },
                cors: {
                    locations: 'nginx.conf',
                    context: 'Add Access-Control-Allow-Origin and related CORS headers in nginx.conf server block.'
                }
            }
        };

        // Universal mappings for all stacks
        const UNIVERSAL_MAPPINGS = {
            dns: {
                actionType: 'EXTERNAL_ACTION',
                locations: 'DNS Provider Console (Cloudflare, GoDaddy, AWS Route53)',
                context: 'Add DNS records through your DNS provider dashboard. Test with tools like MX Toolbox or DNS Checker.'
            },
            dependencies: {
                actionType: 'CODE_REFACTOR',
                locations: 'package.json, composer.json, requirements.txt, pom.xml',
                context: 'Update vulnerable dependencies using package managers. Run security audits regularly.'
            },
            gitExposure: {
                actionType: 'CONFIG_CHANGE',
                locations: '.git folder, .gitignore, nginx.conf',
                context: 'Delete .git folder from production or configure server to block .git access. Add .git to .gitignore.'
            }
        };

        function clearInput() {
            document.getElementById('inputReport').value = '';
            document.getElementById('outputArea').innerHTML = '<div style="text-align: center; color: #484f58; margin-top: 50px;">Waiting for input data...</div>';
            document.getElementById('stats').innerText = '0 prompts';
        }

        function getContextForVulnerability(vulnType, vulnTitle, techStack) {
            const stackConfig = TECH_STACKS_MATRIX[techStack];

            // SSL/TLS Category
            if (vulnType.includes('SSL') || vulnType.includes('TLS') || vulnTitle.includes('Mixed Content')) {
                return {
                    actionType: 'CONFIG_CHANGE',
                    locations: stackConfig.configFiles,
                    context: vulnTitle.includes('Mixed Content')
                        ? `Search for http:// URLs in HTML templates and replace with https://. Check ${stackConfig.images?.locations || 'static files'} for external resources.`
                        : `Configure HTTPS redirects in ${stackConfig.configFiles}.`
                };
            }

            // Security Headers Category
            if (vulnType.includes('INSECURE_HEADERS') || vulnTitle.includes('Content-Security-Policy') || vulnTitle.includes('HSTS') || vulnTitle.includes('X-Frame-Options')) {
                return {
                    actionType: 'CONFIG_CHANGE',
                    locations: stackConfig.headers.locations,
                    context: stackConfig.headers.context
                };
            }

            // DNS Category
            if (vulnType.includes('DNS') || vulnTitle.includes('SPF') || vulnTitle.includes('DMARC') || vulnTitle.includes('DKIM')) {
                return {
                    actionType: 'EXTERNAL_ACTION',
                    locations: UNIVERSAL_MAPPINGS.dns.locations,
                    context: UNIVERSAL_MAPPINGS.dns.context
                };
            }

            // Performance Category
            if (vulnType.includes('PERFORMANCE') || vulnTitle.includes('Gzip') || vulnTitle.includes('compression') || vulnTitle.includes('Cache')) {
                if (vulnTitle.includes('Gzip') || vulnTitle.includes('compression')) {
                    return {
                        actionType: 'CONFIG_CHANGE',
                        locations: stackConfig.compression.locations,
                        context: stackConfig.compression.context
                    };
                }
                if (vulnTitle.includes('Cache')) {
                    return {
                        actionType: 'CONFIG_CHANGE',
                        locations: stackConfig.caching.locations,
                        context: stackConfig.caching.context
                    };
                }
            }

            // XSS Category
            if (vulnType.includes('XSS') || vulnTitle.includes('inline event handler') || vulnTitle.includes('javascript:')) {
                return {
                    actionType: 'CODE_REFACTOR',
                    locations: stackConfig.xssCode.locations,
                    context: stackConfig.xssCode.context
                };
            }

            // Information Disclosure
            if (vulnType.includes('INFORMATION_DISCLOSURE') || vulnTitle.includes('Server header')) {
                if (vulnTitle.includes('Server header')) {
                    return {
                        actionType: 'CONFIG_CHANGE',
                        locations: stackConfig.serverInfo.locations,
                        context: stackConfig.serverInfo.context
                    };
                }
            }

            // Misc Configuration
            if (vulnType.includes('MISCONFIGURATION') || vulnTitle.includes('CORS')) {
                if (vulnTitle.includes('CORS')) {
                    return {
                        actionType: 'CONFIG_CHANGE',
                        locations: stackConfig.cors.locations,
                        context: stackConfig.cors.context
                    };
                }
            }

            // Default fallback
            return {
                actionType: 'CONFIG_CHANGE',
                locations: stackConfig.configFiles,
                context: `Review the vulnerability details and determine appropriate configuration changes for ${stackConfig.name}.`
            };
        }

        function generatePrompts() {
            const text = document.getElementById('inputReport').value;
            const outputArea = document.getElementById('outputArea');
            const techStack = document.getElementById('techStack').value;
            outputArea.innerHTML = '';

            if (!text.trim()) {
                alert('Please paste the report content first.');
                return;
            }

            // Parse vulnerabilities using regex
            const vulnBlocks = text.split(/(?=### \d+\.)/g);
            let count = 0;

            vulnBlocks.forEach(block => {
                const titleMatch = block.match(/### \d+\. (.+?)(?=\n\n|\n\*\*Type:)/s);
                const typeMatch = block.match(/\*\*Type:\*\* (.+?)(?=\n|$)/);
                const severityMatch = block.match(/\*\*Severity:\*\* (.+?)(?=\n|$)/);
                const descMatch = block.match(/\*\*Description:\*\*\n(.+?)(?=\n\n\*\*Recommendation:)/s);
                const recMatch = block.match(/\*\*Recommendation:\*\*\n(.+?)(?=\n\n|$)/s);

                if (titleMatch && descMatch && recMatch) {
                    count++;
                    const title = titleMatch[1].trim();
                    const type = typeMatch ? typeMatch[1].trim() : 'General';
                    const severity = severityMatch ? severityMatch[1].trim() : 'Medium';
                    const desc = descMatch[1].trim();
                    const rec = recMatch[1].trim();

                    // Get context based on tech stack
                    const context = getContextForVulnerability(type, title, techStack);

                    // Determine severity class
                    let cssClass = 'med';
                    if (severity === 'CRITICAL' || severity === 'HIGH') {
                        cssClass = 'high';
                    }

                    // Generate full AI prompt
                    const fullPrompt = `Act as a Senior Security Engineer and an Expert Frontend/Backend Developer.

I have run a security audit and identified the following issue in the codebase:

**ISSUE TITLE:** ${title}
**SEVERITY:** ${severity}
**TYPE:** ${type}

**DESCRIPTION:**
${desc}

**RECOMMENDATION:**
${rec}

**YOUR TASK:**
1. Analyze the relevant files in the current workspace to locate where this issue exists.
2. Implement the necessary code or configuration changes to fix this vulnerability according to the recommendation.
3. Ensure the fix follows best security practices (OWASP).
4. Explain briefly what you changed and why.

**SPECIFIC CONTEXT:**
${context.context}

**LIKELY FILE LOCATIONS:**
${context.locations}

**ACTION TYPE REQUIRED:**
${context.actionType}

**Constraints:**
- Do not ask me for permission, just fix it.
- If the issue is in a config file (like vercel.json, next.config.js, headers), modify it directly.
- Be precise and provide working code examples.
- Test the changes to ensure they work correctly.

**URL:** [INSERT_TARGET_URL]
**DOMAIN:** [INSERT_DOMAIN]`;

                    // Create HTML card
                    const card = document.createElement('div');
                    card.className = `prompt-card ${cssClass}`;

                    card.innerHTML = `
                        <div class="card-header">
                            <span>${title}</span>
                            <span class="badge ${cssClass}">${severity}</span>
                        </div>
                        <div class="card-header" style="margin-bottom: 10px;">
                            <span>Action: ${context.actionType}</span>
                            <span>Stack: ${TECH_STACKS_MATRIX[techStack].name}</span>
                        </div>
                        <div class="prompt-content">${fullPrompt}</div>
                        <button class="btn" onclick="copyToClipboard(this)">ðŸ“‹ Copy Prompt for Agent</button>
                    `;
                    outputArea.appendChild(card);
                }
            });

            document.getElementById('stats').innerText = `${count} prompts generated for ${TECH_STACKS_MATRIX[techStack].name}`;
        }

        function copyToClipboard(btnElement) {
            const promptText = btnElement.parentElement.querySelector('.prompt-content').innerText;

            navigator.clipboard.writeText(promptText).then(() => {
                const originalText = btnElement.innerText;
                btnElement.innerText = 'âœ… Copied!';
                btnElement.style.background = '#238636';

                setTimeout(() => {
                    btnElement.innerText = originalText;
                    btnElement.style.background = '';
                }, 2000);
            });
        }
    </script>
</body>
</html>